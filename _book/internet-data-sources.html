<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Real Estate Market Analysis</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Materials for Real Estate Market Analysis course conducted at Poznań University of Economics and Business">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Real Estate Market Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Materials for Real Estate Market Analysis course conducted at Poznań University of Economics and Business" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Real Estate Market Analysis" />
  
  <meta name="twitter:description" content="Materials for Real Estate Market Analysis course conducted at Poznań University of Economics and Business" />
  

<meta name="author" content="Maciej Beręsewicz">


<meta name="date" content="2017-03-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-sources.html">
<link rel="next" href="characteristics-of-real-estate-market-in-poland-and-europe.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#basic-definitions"><i class="fa fa-check"></i><b>2.1</b> Basic definitions</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#real-estate-market-characteristics-and-functions"><i class="fa fa-check"></i><b>2.2</b> Real estate market – characteristics and functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>3</b> Data sources on real estate market</a><ul>
<li class="chapter" data-level="3.1" data-path="data-sources.html"><a href="data-sources.html#basic-data-sources"><i class="fa fa-check"></i><b>3.1</b> Basic data sources</a></li>
<li class="chapter" data-level="3.2" data-path="data-sources.html"><a href="data-sources.html#where-we-can-get-these-data"><i class="fa fa-check"></i><b>3.2</b> Where we can get these data?</a></li>
<li class="chapter" data-level="3.3" data-path="data-sources.html"><a href="data-sources.html#obtaining-data-from-the-internet"><i class="fa fa-check"></i><b>3.3</b> Obtaining data from the Internet</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-sources.html"><a href="data-sources.html#oecd-package"><i class="fa fa-check"></i><b>3.3.1</b> OECD package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="internet-data-sources.html"><a href="internet-data-sources.html"><i class="fa fa-check"></i><b>4</b> Internet data sources</a><ul>
<li class="chapter" data-level="4.1" data-path="internet-data-sources.html"><a href="internet-data-sources.html#some-theory"><i class="fa fa-check"></i><b>4.1</b> Some theory</a></li>
<li class="chapter" data-level="4.2" data-path="internet-data-sources.html"><a href="internet-data-sources.html#scraping-data-from-morizon.pl-step-by-step"><i class="fa fa-check"></i><b>4.2</b> Scraping data from Morizon.pl – step by step</a></li>
<li class="chapter" data-level="4.3" data-path="internet-data-sources.html"><a href="internet-data-sources.html#scraping-data-from-otodom.pl-step-by-step"><i class="fa fa-check"></i><b>4.3</b> Scraping data from OtoDom.pl – step by step</a><ul>
<li class="chapter" data-level="4.3.1" data-path="internet-data-sources.html"><a href="internet-data-sources.html#full-code-for-morizon"><i class="fa fa-check"></i><b>4.3.1</b> Full code for Morizon</a></li>
<li class="chapter" data-level="4.3.2" data-path="internet-data-sources.html"><a href="internet-data-sources.html#full-code-for-otodom"><i class="fa fa-check"></i><b>4.3.2</b> Full code for OtoDom</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="characteristics-of-real-estate-market-in-poland-and-europe.html"><a href="characteristics-of-real-estate-market-in-poland-and-europe.html"><i class="fa fa-check"></i><b>5</b> Characteristics of Real Estate Market in Poland and Europe</a></li>
<li class="chapter" data-level="6" data-path="descriptives-statistics-as-basic-method-of-analysis-of-real-estate-market.html"><a href="descriptives-statistics-as-basic-method-of-analysis-of-real-estate-market.html"><i class="fa fa-check"></i><b>6</b> Descriptives statistics as basic method of analysis of Real Estate Market</a></li>
<li class="chapter" data-level="7" data-path="data-cleaning-techniques-and-outliers-detection.html"><a href="data-cleaning-techniques-and-outliers-detection.html"><i class="fa fa-check"></i><b>7</b> Data cleaning techniques and outliers detection</a></li>
<li class="chapter" data-level="8" data-path="indices.html"><a href="indices.html"><i class="fa fa-check"></i><b>8</b> Indices</a></li>
<li class="chapter" data-level="9" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>9</b> Regression</a></li>
<li class="chapter" data-level="10" data-path="gis-tools.html"><a href="gis-tools.html"><i class="fa fa-check"></i><b>10</b> GIS Tools</a></li>
<li class="chapter" data-level="11" data-path="spatial-models.html"><a href="spatial-models.html"><i class="fa fa-check"></i><b>11</b> Spatial models</a></li>
<li class="chapter" data-level="12" data-path="forecasting.html"><a href="forecasting.html"><i class="fa fa-check"></i><b>12</b> Forecasting</a></li>
<li class="chapter" data-level="13" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>13</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Real Estate Market Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="internet-data-sources" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Internet data sources</h1>
<div id="some-theory" class="section level2">
<h2><span class="header-section-number">4.1</span> Some theory</h2>
</div>
<div id="scraping-data-from-morizon.pl-step-by-step" class="section level2">
<h2><span class="header-section-number">4.2</span> Scraping data from Morizon.pl – step by step</h2>
<p>We enter the following page <a href="http://www.morizon.pl/ceny/" class="uri">http://www.morizon.pl/ceny/</a> which by default loads data for Warsaw. This is presented on Figure <a href="internet-data-sources.html#fig:morizon1">4.1</a></p>
<div class="figure"><span id="fig:morizon1"></span>
<img src="images/ch3/morizon1.png" alt="Morizon" width="1021" />
<p class="caption">
Figure 4.1: Morizon
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doc &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&#39;http://www.morizon.pl/ceny/&#39;</span>)</code></pre></div>
<p>To check where the data is click right mouse and “inspect element”. This is presented on Figure <a href="internet-data-sources.html#fig:morizon2">4.2</a>.</p>
<div class="figure"><span id="fig:morizon2"></span>
<img src="images/ch3/morizon2.png" alt="Morizon -- inspect element" width="462" />
<p class="caption">
Figure 4.2: Morizon – inspect element
</p>
</div>
<p>Search for the line with <code>&lt;script type='text/javascript'&gt;...&lt;/script&gt;</code>. This is presented on Figure <a href="internet-data-sources.html#fig:morizon3">4.3</a> and <a href="internet-data-sources.html#fig:morizon4">4.4</a>.</p>
<div class="figure"><span id="fig:morizon3"></span>
<img src="images/ch3/morizon3.png" alt="Morizon -- script (text/javascript)" width="625" />
<p class="caption">
Figure 4.3: Morizon – script (text/javascript)
</p>
</div>
<div class="figure"><span id="fig:morizon4"></span>
<img src="images/ch3/morizon4.png" alt="Morizon" width="569" />
<p class="caption">
Figure 4.4: Morizon
</p>
</div>
<p>To get this into R use the following code to gather the data referring to all scripts. Next, we need to look for specific text that is presented on Figure <a href="internet-data-sources.html#fig:morizon5">4.5</a>, in particular we seek for <code>newDate.setYear</code> or <code>newDate.setMonth</code> or <code>newDate.setDate</code> or other from <code>chartData.push</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scripts &lt;-<span class="st"> </span>doc %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;script&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>()</code></pre></div>
<div class="figure"><span id="fig:morizon5"></span>
<img src="images/ch3/morizon5.png" alt="Morizon" width="338" />
<p class="caption">
Figure 4.5: Morizon
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flag &lt;-<span class="st"> </span><span class="kw">stri_detect</span>(<span class="dt">str =</span> scripts, <span class="dt">fixed =</span> <span class="st">&#39;newDate.setMonth&#39;</span>)
flag</code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
## [23] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selected &lt;-<span class="st"> </span>scripts[flag]

<span class="kw">length</span>(selected)</code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>Now, we will work only on the one element of <code>selected</code> list for clarity, which refers to overall price for m2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">warsaw &lt;-<span class="st"> </span>selected[[<span class="dv">1</span>]]</code></pre></div>
<p>We need to match the following strings and I provide a regular expression code to extract them.</p>
<ul>
<li><code>setYear(2006)</code> – <code>setYear\\(\\d{4}\\)</code></li>
<li><code>setMonth(11)</code> – <code>setMonth\\(\\d{1,2}\\)</code></li>
<li><code>setDate(1)</code> – <code>setDate\\(\\d{1,2}\\)</code></li>
<li><code>visits: 8560</code> – <code>visits\\:\\s+\\d{1,5}</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prices &lt;-<span class="st"> </span><span class="kw">stri_extract</span>(<span class="dt">str =</span> warsaw,
                       <span class="dt">regex =</span> <span class="st">&#39;visits</span><span class="ch">\\</span><span class="st">:</span><span class="ch">\\</span><span class="st">s+</span><span class="ch">\\</span><span class="st">d{1,5}&#39;</span>,
                       <span class="dt">mode =</span> <span class="st">&#39;all&#39;</span>)
prices &lt;-<span class="st"> </span><span class="kw">unlist</span>(prices)
<span class="kw">head</span>(prices)</code></pre></div>
<pre><code>## [1] &quot;visits: 8560&quot; &quot;visits: 8656&quot; &quot;visits: 9017&quot; &quot;visits: 9296&quot;
## [5] &quot;visits: 9366&quot; &quot;visits: 9540&quot;</code></pre>
<p>From this, we need to exctract only numeric characters</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prices &lt;-<span class="st"> </span><span class="kw">stri_extract</span>(<span class="dt">str =</span> prices,
                       <span class="dt">regex =</span> <span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>,
                       <span class="dt">mode =</span> <span class="st">&#39;all&#39;</span>,
                       <span class="dt">simplify =</span> T)
prices &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(prices) 
<span class="kw">plot</span>(prices, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;Time&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Price PLN/m2&#39;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="scraping-data-from-otodom.pl-step-by-step" class="section level2">
<h2><span class="header-section-number">4.3</span> Scraping data from OtoDom.pl – step by step</h2>
<div class="figure"><span id="fig:otodom1"></span>
<img src="images/ch3/otodom1.png" alt="Otodom" width="1192" />
<p class="caption">
Figure 4.6: Otodom
</p>
</div>
<div class="figure"><span id="fig:otodom2"></span>
<img src="images/ch3/otodom2.png" alt="Otodom" width="1172" />
<p class="caption">
Figure 4.7: Otodom
</p>
</div>
<div class="figure"><span id="fig:otodom3"></span>
<img src="images/ch3/otodom3.png" alt="Otodom" width="1167" />
<p class="caption">
Figure 4.8: Otodom
</p>
</div>
<p><a href="https://www.otodom.pl/sprzedaz/mieszkanie/poznan/?search%5Bfilter_enum_market%5D%5B0%5D=secondary&amp;search%5Bdescription%5D=1&amp;search%5Bcreated_since%5D=14&amp;search%5Bdist%5D=0">https://www.otodom.pl/sprzedaz/mieszkanie/poznan/?search%5Bfilter_enum_market%5D%5B0%5D=secondary&amp;search%5Bdescription%5D=1&amp;search%5Bcreated_since%5D=14&amp;search%5Bdist%5D=0</a></p>
<p>We need to add page numer <code>&amp;page=1</code>, so we will be able to scrape all result pages.</p>
<p><a href="https://www.otodom.pl/sprzedaz/mieszkanie/poznan/?search%5Bfilter_enum_market%5D%5B0%5D=secondary&amp;search%5Bdescription%5D=1&amp;search%5Bcreated_since%5D=14&amp;search%5Bdist%5D=0&amp;page=1">https://www.otodom.pl/sprzedaz/mieszkanie/poznan/?search%5Bfilter_enum_market%5D%5B0%5D=secondary&amp;search%5Bdescription%5D=1&amp;search%5Bcreated_since%5D=14&amp;search%5Bdist%5D=0&amp;page=1</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://www.otodom.pl/sprzedaz/mieszkanie/poznan/?search%5Bfilter_enum_market%5D%5B0%5D=secondary&amp;search%5Bdescription%5D=1&amp;search%5Bcreated_since%5D=14&amp;search%5Bdist%5D=0&amp;page=1&#39;</span>
doc &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</code></pre></div>
<div class="figure"><span id="fig:otodom4"></span>
<img src="images/ch3/otodom5.png" alt="Otodom" width="846" />
<p class="caption">
Figure 4.9: Otodom
</p>
</div>
<div class="figure"><span id="fig:otodom4"></span>
<img src="images/ch3/otodom6.png" alt="Otodom" width="895" />
<p class="caption">
Figure 4.9: Otodom
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">offers &lt;-<span class="st"> </span>doc %&gt;%<span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&#39;div.offer-item-details&#39;</span>)

offer_title &lt;-<span class="st"> </span>offers %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;span.offer-item-title&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>()

<span class="kw">head</span>(offer_title)</code></pre></div>
<pre><code>## [1] &quot;POZNAŃ Nowe Mieszkanie Grunwald&quot;                   
## [2] &quot;PROMOCJA! 275.000 zł za 75 m², 4 pokoje, taras.&quot;   
## [3] &quot;Funkcjonalne Kominek, Ogródek, Osiedle Zamknięte !&quot;
## [4] &quot;Mieszkanie 39 m2 za 192 750 zł! Parking w cenie!!!&quot;
## [5] &quot;2 pokoje, Poznań ul. Czysta wyposażone do wprowadz&quot;
## [6] &quot;Mieszkanie, 71 m², Poznań&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">offer_total_price &lt;-<span class="st"> </span>offers %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;li.offer-item-price&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>() %&gt;%
<span class="st">  </span><span class="kw">stri_replace_all</span>(., <span class="dt">rep=</span><span class="st">&#39;&#39;</span>,<span class="dt">regex=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">s+&#39;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">stri_extract_all</span>(., <span class="dt">regex =</span> <span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">unlist</span>() %&gt;%
<span class="st">  </span><span class="kw">as.numeric</span>()

<span class="kw">head</span>(offer_total_price)</code></pre></div>
<pre><code>## [1] 300000 275000 339000 192750 257000 385000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">offer_floor_area &lt;-<span class="st"> </span>offers %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;li.hidden-xs.offer-item-area&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>() %&gt;%
<span class="st">  </span><span class="kw">stri_replace_all</span>(., <span class="dt">rep=</span><span class="st">&#39;&#39;</span>,<span class="dt">regex=</span><span class="st">&#39;m²|</span><span class="ch">\\</span><span class="st">s+&#39;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">stri_replace_all</span>(., <span class="dt">rep=</span><span class="st">&#39;.&#39;</span>,<span class="dt">fixed=</span><span class="st">&#39;,&#39;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">unlist</span>() %&gt;%
<span class="st">  </span><span class="kw">as.numeric</span>()

<span class="kw">head</span>(offer_floor_area)</code></pre></div>
<pre><code>## [1] 45.79 74.98 73.00 38.55 47.00 71.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> offer_floor_area,
     <span class="dt">y =</span> offer_total_price/<span class="dv">1000</span>,
     <span class="dt">xlab =</span> <span class="st">&#39;Floor area (m2)&#39;</span>,
     <span class="dt">ylab =</span> <span class="st">&#39;Price for property in k PLN&#39;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div id="full-code-for-morizon" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Full code for Morizon</h3>
<div id="scrape-data-for-warsaw" class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> Scrape data for Warsaw</h4>
<p>We scrape data from Morizon’s web statistics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prices &lt;-<span class="st"> &#39;http://www.morizon.pl/ceny/&#39;</span> %&gt;%
<span class="st">  </span>read_html %&gt;%
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;script&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span>.[<span class="kw">stri_detect</span>(<span class="dt">str =</span> ., <span class="dt">regex =</span> <span class="st">&#39;newDate.setYear&#39;</span>)] %&gt;%
<span class="st">  </span><span class="kw">stri_extract_all</span>(<span class="dt">regex =</span> <span class="st">&#39;setYear</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{4}</span><span class="ch">\\</span><span class="st">)|setMonth</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">)|setDate</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">)|visits</span><span class="ch">\\</span><span class="st">:</span><span class="ch">\\</span><span class="st">s{1}</span><span class="ch">\\</span><span class="st">d{4,5}&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">stri_extract_all</span>(<span class="dt">regex =</span> <span class="st">&#39;</span><span class="ch">\\</span><span class="st">d{1,}&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">lapply</span>(., function(x) {
  x %&gt;%
<span class="st">  </span><span class="kw">as.numeric</span>() %&gt;%
<span class="st">  </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> T) %&gt;%
<span class="st">  </span><span class="kw">as.data.frame</span>() %&gt;%
<span class="st">      </span><span class="kw">rename</span>(
        <span class="dt">year =</span> V1,
        <span class="dt">month =</span> V2,
        <span class="dt">day =</span> V3,
        <span class="dt">pricem2 =</span> V4) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">ymd</span>(<span class="kw">paste</span>(year, month +<span class="st"> </span><span class="dv">1</span>, day, <span class="dt">sep =</span> <span class="st">&#39;-&#39;</span>)))
  })
  
prices[[<span class="dv">1</span>]]$stat &lt;-<span class="st"> &#39;overall&#39;</span>
prices[[<span class="dv">2</span>]]$stat &lt;-<span class="st"> &#39;1 room&#39;</span>
prices[[<span class="dv">3</span>]]$stat &lt;-<span class="st"> &#39;2 rooms&#39;</span>
prices[[<span class="dv">4</span>]]$stat &lt;-<span class="st"> &#39;3 rooms&#39;</span>
prices[[<span class="dv">5</span>]]$stat &lt;-<span class="st"> &#39;4 rooms&#39;</span>


prices %&gt;%
<span class="st">  </span><span class="kw">bind_rows</span>() %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ,
  <span class="kw">aes</span>(<span class="dt">x =</span> date,
      <span class="dt">y =</span> pricem2,
      <span class="dt">group =</span> stat,
      <span class="dt">colour =</span> stat)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x  =</span> <span class="st">&#39;Day&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Price / m2&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Average price m2 for Warsaw&#39;</span>,
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.morizon.pl/ceny/&#39;</span>
  )</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/morizon-warsaw-only-1.png" width="672" /></p>
</div>
<div id="scrape-data-for-other-cities" class="section level4">
<h4><span class="header-section-number">4.3.1.2</span> Scrape data for other cities</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">links &lt;-<span class="st"> &#39;http://www.morizon.pl/ceny/&#39;</span> %&gt;%
<span class="st">  </span>read_html %&gt;%
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;select.cities_select option&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&#39;value&#39;</span>) 

links &lt;-<span class="st"> </span>links[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">17</span>)]

prices_cities &lt;-<span class="st"> </span><span class="kw">lapply</span>(links, function(x) {
  x %&gt;%
<span class="st">  </span>read_html %&gt;%
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;script&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>() %&gt;%<span class="st"> </span>
<span class="st">    </span>.[<span class="kw">stri_detect</span>(<span class="dt">str =</span> ., <span class="dt">regex =</span> <span class="st">&#39;newDate.setYear&#39;</span>)] %&gt;%
<span class="st">  </span><span class="kw">stri_extract_all</span>(<span class="dt">regex =</span> <span class="st">&#39;setYear</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{4}</span><span class="ch">\\</span><span class="st">)|setMonth</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">)|setDate</span><span class="ch">\\</span><span class="st">(</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">)|visits</span><span class="ch">\\</span><span class="st">:</span><span class="ch">\\</span><span class="st">s{1}</span><span class="ch">\\</span><span class="st">d{4,5}&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">stri_extract_all</span>(<span class="dt">regex =</span> <span class="st">&#39;</span><span class="ch">\\</span><span class="st">d{1,}&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">unlist</span>() %&gt;%
<span class="st">  </span><span class="kw">as.numeric</span>() %&gt;%
<span class="st">  </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> T) %&gt;%
<span class="st">  </span><span class="kw">as.data.frame</span>() %&gt;%
<span class="st">      </span><span class="kw">rename</span>(
        <span class="dt">year =</span> V1,
        <span class="dt">month =</span> V2,
        <span class="dt">day =</span> V3,
        <span class="dt">pricem2 =</span> V4) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">ymd</span>(<span class="kw">paste</span>(year, month +<span class="st"> </span><span class="dv">1</span>, day, <span class="dt">sep =</span> <span class="st">&#39;-&#39;</span>)),
         <span class="dt">city =</span> <span class="kw">stri_replace</span>(<span class="dt">str =</span> x,
                             <span class="dt">rep =</span> <span class="st">&#39;&#39;</span>,
                             <span class="dt">fixed =</span> <span class="st">&#39;http://www.morizon.pl/ceny/&#39;</span>),
         <span class="dt">city =</span> <span class="kw">stri_replace</span>(city,<span class="st">&#39;&#39;</span>,<span class="dt">fixed=</span><span class="st">&#39;/&#39;</span>))
}) %&gt;%
<span class="st">  </span><span class="kw">bind_rows</span>()
  

prices_cities %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ,
  <span class="kw">aes</span>(<span class="dt">x =</span> date,
      <span class="dt">y =</span> pricem2,
      <span class="dt">group =</span> city,
      <span class="dt">colour =</span> city)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x  =</span> <span class="st">&#39;Day&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Price / m2&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Average price m2&#39;</span>,
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.morizon.pl/ceny/&#39;</span>
  )</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/morizon-other-cities-1.png" width="672" /></p>
</div>
</div>
<div id="full-code-for-otodom" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Full code for OtoDom</h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="characteristics-of-real-estate-market-in-poland-and-europe.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-internet-data-sources.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
